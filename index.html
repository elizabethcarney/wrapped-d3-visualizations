<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <title>Scatterplot Demo</title>
</head>

<body>
  <!-- GitHub corner -->
  <svg width="80" height="80" viewBox="0 0 250 250"
    style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <a href="https://github.com/elizabethcarney/wrapped-d3-visualizations" target="_blank" class="github-corner" aria-label="View source on Github">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path style="fill:white;"
        d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
        style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path style="fill:white;"
        d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
        class="octo-body"></path>
    </a>
  </svg>

  <div class="container">
    <div class="row">
      <div class="col-12">
        <!-- Title -->
        <br><br>
        <h2> Wrapped-D3 Scatterplot </h2>
        <h5> Elizabeth Carney </h5>
        <br><br>

        <!-- What is this? collapsible card -->
        <div class="card">
          <div class="card-header">
            <a id="collapseBtn" class="btn btn-light" data-toggle="collapse" href="#collapseInfo" role="button" aria-expanded="false" aria-controls="collapseInfo" style="width:100%;text-align:left;margin:0;font-size:1.5em;">
              <h5 style="float:left;margin-right:20px;">What is this?</h5><i class="fas fa-chevron-down" style="float:right;"></i>
            </a>
          </div>
          <div id="collapseInfo" class="collapse">
            <div class="card-body">
              <p class="card-text">
                <b>This is a scatterplot created with the C++-wrapped version of D3.js in <a href="https://github.com/devosoft/Empirical">Empirical</a>.</b>
                <br>Click on the different tabs to see some different kinds of scatterplots that you can
                make with Empirical, coding in C++ instead of JavaScript. They get more complex from
                left to right, so I suggest starting with <b>Foundation</b>. Feel free to use this code
                as a jumping-off point for your own visualizations!

                <br><br><a href="https://cse.msu.edu/~dolsonem/">Dr. Emily Dolson</a>,
                <a href="https://lalejini.com/">Alex Lalejini</a>,
                <a href="https://github.com/Oliver-BE">Oliver Baldwin Edwards</a>,
                and I rewrote and revamped the D3-wrapper during the summer of 2020 for WAVES
                (a workshop for the development of Avida-ED and its underlying tools). I am so
                thankful to have gotten the chance to work with them, and thank you for checking
                out this demo!

                <br><br>Please take a look at <a href="http://mmore500.com/waves/blog/wrapped-d3-visualizations.html">my blogpost about this project</a>
                for more information and further resources.
              </p>
            </div>
          </div>
          </div>
        <br><br>

        <!-- Tabs for different versions of scatterplot -->
        <nav>
          <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-foundation-tab" data-toggle="tab" href="#nav-foundation" role="tab" aria-controls="nav-home" aria-selected="true">Foundation</a>
            <a class="nav-item nav-link" id="nav-other1-tab" data-toggle="tab" href="#nav-other1" role="tab" aria-controls="nav-profile" aria-selected="false">Other1</a>
            <a class="nav-item nav-link" id="nav-other2-tab" data-toggle="tab" href="#nav-other2" role="tab" aria-controls="nav-contact" aria-selected="false">Other2</a>
          </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
          <!-- Foundation -->
          <div class="tab-pane fade show active" id="nav-foundation" role="tabpanel" aria-labelledby="nav-foundation-tab">
            <div id="foundation-div">
              <div class="row">
                <div class="col-12">
                  <div id="foundation-viz"></div>
                </div>
              </div>
              <div class="row">
                <div class="col-10 offset-1">
                  <!-- Foundation Info -->
                  <hr><br>
                  <h3>The Foundation</h3><br>
                  <p>
                    <b>The Foundation</b> is your basic scatterplot, no fluff, no frills. It may seem
                      plain to some, but in certain cases it's exactly what you need. A million different
                      colors with things swooshing around the screen can be overwhelming and make
                      your visualization hard to look at; it can even distract a viewer from the message
                      you're trying to communicate through your data. Every so often, you'll want to
                      come back to <b>The Foundation</b> for quick and easy scatterplots.
                    <br><br>Here are it's main features:<br>
                    <ul>
                      <li>It's fully static (no animations or transitions included).</li>
                      <li>Circles represent each data point relative to the x- and y-axis.</li>
                      <li>The axes have ticks (little lines with numerical "checkpoints") and labels.</li>
                      <li>The SVG that it's positioned within has a special <code>viewBox</code> attribute—this
                        is a must for making your website responsive so that it looks good on all screen sizes!
                        According to the width and height that you give it, <code>viewBox</code> will always
                        preserve the SVG's aspect ratio and resize it depending on the container it's in.</li>
                    </ul>
                    Here are the basic steps that I took to create it:<br><br>
                    <ol>
                        <li>Hold the data in a simple <code>emp::vector&lt;emp::vector&lt;double&gt;&gt;</code>
                          <br>(an Empirical vector type).</li>
                        <li>Add an <code>svg</code> to my page with <code>.Append("svg");</code> (which will
                          hold all of the D3 objects we draw).</li>
                        <li>Create an <code>x_scale</code> and a <code>y_scale</code>. A scale's domain is
                          the lower and upper limit of the data that will be graphed on it, and its range
                          is the lower and upper limit of the space it will cover—in other words,
                          the pixels it will be drawn on. The <code>x_scale</code>'s range starts at
                          60px instead of 0 to leave room for the <code>left_axis</code>'s ticks and label.</li>
                        <li>Create two axes, one on the bottom and one on the left, shifting them down and
                          to the right respectively so that their origins meet up at (0, 0). Here I'm using
                          the Axis constructor that takes <code>shift_x</code> and <code>shift_y</code>
                          arguments to position them correctly.</li>
                        <li>Bind the data to an empty selection called <code>circles</code>.</li>
                        <li>For each piece of data that doesn't already have a corresponding element on the DOM,
                          append a circle to the svg. Then, set the circle's x-coordinate to the first number in
                          each data pair, and set its y-coordinate to the second number (both scaled to have the
                          correct position relative to the axes).</li>
                    </ol>
                    And finally, here's the code for <b>The Foundation</b>:
                  </p>
                  <!-- Foundation Code -->
                  <pre class="card card-body pre-scrollable" id="foundation-code">
<code>#include "../third-party/Empirical/source/web/d3/d3_init.h"
#include "../third-party/Empirical/source/web/d3/selection.h"
#include "../third-party/Empirical/source/web/d3/scales.h"
#include "../third-party/Empirical/source/web/d3/axis.h"

void MakeTheFoundation() {

  // store data in vector of doubles
  emp::vector&lt;emp::vector&lt;double&gt;&gt; example_data = {
    {1,0}, {5,1}, {8,0.5}, {14,2.5}, {15,1.6}, {19,2.3}, {28,2.5}, {28,3.4}, {33,3.2},
    {35,2.2}, {43,4.8}, {48,2.6}, {58,3.4}, {63,5.2}, {67,3.9}, {64,5.7}, {75,4},
    {34,3.3}, {40,4.1}, {52,3.3}, {52,4.7}, {55,4.5}, {67,4.9}, {66,6.5}, {75,5.6},
    {79,5.4}, {83,5.8}, {93,6.4}, {100,7}, {97,7}, {98,6.2}, {99,6.9}, {100,6.8}
  };

  std::string x_label = "days in quarantine";
  std::string y_label = "days per week wearing sweatpants";

  double svg_width = 700;
  double svg_height = 500;
  double graph_width = 600;
  double graph_height = 400;

  // set padding for axes
  double padding_left = 60;
  double padding_top = (svg_height - graph_height)/2;

  // set up div and responsive svg
  D3::Selection viz_div = D3::Select("#foundation-viz");
  D3::Selection viz_svg = viz_div.Append("svg").SetAttr("id", "scatterplot_svg")
                          .SetAttr("viewBox", "0 0 " +std::to_string(svg_width)+ " " +std::to_string(svg_height));

  // set up scales
  D3::LinearScale x_scale = D3::LinearScale();
  x_scale.SetDomain(0, 100).SetRange(padding_left, graph_width+padding_left);
  D3::LinearScale y_scale = D3::LinearScale();
  y_scale.SetDomain(0, 7).SetRange(graph_height+padding_top, padding_top);

  // set up axes with shifts according to scale range
  D3::Axis&lt;D3::LinearScale&gt; bottom_axis = D3::Axis&lt;D3::LinearScale&gt;(0, graph_height+padding_top, "bottom", x_label).SetScale(x_scale).Draw(viz_svg);
  D3::Axis&lt;D3::LinearScale&gt; left_axis = D3::Axis&lt;D3::LinearScale&gt;(padding_left, 0, "left", y_label).SetScale(y_scale).Draw(viz_svg);

  // set up circle data points
  D3::Selection data_points = viz_svg.SelectAll("circle");
  // bind data and assign a circle to each data point that doesn't have a DOM element
  // (use lambdas for ApplyScale so that it's in scope)
  D3::Selection circles = viz_svg.SelectAll("circle")
      .Data(example_data)
      .EnterAppend("circle")
      .SetAttr("cx", [&example_data, &x_scale](int d, int i, int j) { return x_scale.ApplyScale&lt;double, double&gt;(example_data.at(i).at(0)); })
      .SetAttr("cy", [&example_data, &y_scale](int d, int i, int j) { return y_scale.ApplyScale&lt;double, double&gt;(example_data.at(i).at(1)); })
      .SetAttr("r", 3);

}

int main() {
  D3::InitializeEmpD3();
  MakeTheFoundation();

  return 0;
}
</code>
                  </pre>

                </div>
              </div>
            </div>
          </div>

          <!-- Other1 -->
          <div class="tab-pane fade" id="nav-other1" role="tabpanel" aria-labelledby="nav-other1-tab">
            <div id="scatterplot-v-other-1">placeholder</div>
          </div>

          <!-- Other2 -->
          <div class="tab-pane fade" id="nav-other2" role="tabpanel" aria-labelledby="nav-other2-tab">
            <div id="scatterplot-v-other-2">placeholder</div>
          </div>
        </div>

        <br><br>

      </div>
    </div>
  </div>

  <!-- D3.js (must come before demo.js) -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js"></script>

  <!-- Font Awesome-->
  <script src="https://kit.fontawesome.com/64b5ee06ae.js" crossorigin="anonymous"></script>

  <!-- demo scatterplot written in C++ and compiled with Emscripten -->
  <script type="text/javascript" src="source/web/demo.js"></script>

  <!-- JQuery, Popper, and Bootstrap -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <script>
    $('#collapseInfo').on('hidden.bs.collapse', function () {
      $('#collapseBtn').html('<h5 style="float:left;margin-right:20px;">What is this?</h5><i class="fas fa-chevron-down" style="float:right;"></i>');
    })
    $('#collapseInfo').on('shown.bs.collapse', function () {
      $('#collapseBtn').html('<h5 style="float:left;margin-right:20px;">What is this?</h5><i class="fas fa-chevron-up" style="float:right;"></i>');
    })
  </script>

</body>

</html>